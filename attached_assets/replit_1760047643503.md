# QGC Comparador - PDF Creditor Analysis Tool

## Overview

QGC Comparador é um aplicativo web baseado em Streamlit projetado para comparar inteligentemente documentos de "Quadro Geral de Credores" usando análise com IA. A ferramenta extrai informações de credores de documentos PDF, compara versões antigas e novas, e identifica mudanças como novos credores, credores removidos e modificações em entradas existentes. Os resultados podem ser exportados em CSV ou Excel para análise adicional.

**Status Atual**: MVP funcional completo com extração via IA, comparação inteligente e exportação de dados.

## Recent Changes

### 2025-10-09: Implementação do MVP
- ✅ Upload de dois PDFs (versão antiga e nova do QGC)
- ✅ Extração de texto robusta usando PyPDF2 e pdfplumber
- ✅ Integração com Fal.ai API (any-llm) com seleção de modelos
- ✅ Parser de IA robusto com múltiplas estratégias de extração de JSON
- ✅ Comparação automática de credores com matching por similaridade
- ✅ Interface com tabs para visualização de resultados (novos, removidos, modificados, todos)
- ✅ Exportação para CSV e Excel com múltiplas planilhas
- ✅ Debug logging para troubleshooting de respostas da IA

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Application Framework
- **Frontend/UI**: Streamlit web framework
  - Provides interactive UI with file upload, model selection, and results visualization
  - Session state management for multi-step workflows
  - Wide layout configuration for data-heavy displays
  - Sidebar for configuration options (model selection, match threshold)

### Document Processing Pipeline
- **PDF Text Extraction**: Multi-library approach for robust extraction
  - Primary: pdfplumber (optimized for tables and complex layouts)
  - Fallback: PyPDF2 (alternative extraction method)
  - Strategy: Uses whichever library produces longer/better text output
  - Text cleaning and normalization performed post-extraction

### AI Analysis Architecture
- **AI Provider**: Fal.ai API integration
  - Model-agnostic design supporting multiple LLMs
  - Configurable model selection (GPT-4, GPT-5, Gemini-2.5-Pro)
  - Low temperature (0.1) for consistent, deterministic extraction
  - Structured prompt engineering for creditor data extraction

### Data Processing Components
- **Comparison Engine**: Rule-based matching and diff detection
  - Fuzzy matching using difflib for creditor name matching
  - Configurable match threshold (default 0.8)
  - Change categorization: new, removed, modified, unchanged
  - Confidence scoring for matches

- **Data Export**: CSV generation for analysis results
  - Combines all change categories into unified dataset
  - Status tracking (NOVO, REMOVIDO, MODIFICADO)
  - Value change tracking (old value, new value, difference)

### Application Modes
- **Standard Mode**: Full-featured comparison with multiple model options
- **Single Mode**: Simplified mode using AnyLLM provider exclusively
  - Environment variable-based model configuration
  - Streamlined UI with minimal settings

### State Management
- Session state variables:
  - `comparison_results`: Stores comparison output
  - `processing_complete`: Workflow completion flag
  - `processing_started`: Tracks processing initiation (single mode)

## External Dependencies

### AI Services
- **Fal.ai API** (fal_client)
  - Endpoint: `fal-ai/any-llm`
  - Authentication: FAL_KEY environment variable
  - Purpose: LLM inference for creditor extraction
  - Supported models: OpenAI GPT-4/5, Google Gemini 2.5 Pro

### PDF Processing Libraries
- **pdfplumber**: Primary PDF extraction (handles complex layouts, tables)
- **PyPDF2**: Backup PDF extraction library

### Data Processing
- **pandas**: Data manipulation and CSV export functionality
- **difflib** (Python stdlib): String similarity matching for creditor comparison

### UI Framework
- **Streamlit**: Web application framework
  - File upload widgets
  - Configuration controls (selectbox, slider)
  - Results visualization

### Environment Configuration
- **python-dotenv**: Environment variable management
- Required environment variables:
  - `FAL_KEY`: Fal.ai API authentication
  - `MODEL_PROVIDER`: AI provider selection (single mode)
  - `ANYLLM_MODEL`: Model ID for AnyLLM mode
  - Optional model-specific variables: `ANYLLM_MODEL_CHATGPT4`, `ANYLLM_MODEL_GPT5`, `ANYLLM_MODEL_GEMINI25`